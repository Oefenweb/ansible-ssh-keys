---

- block:
    - name: Generate private ssh key
      openssl_privatekey:
        path: "{{ item.path }}"
        cipher: "{{ item.cipher | default(omit) }}"
        force: "{{ item.force | default(false) }}"
        owner: "{{ item.owner }}"
        group: "{{ item.group | default(item.owner) }}"
        mode: "{{ item.mode | default(0600) }}"
        passphrase: "{{ item.passphrase | default(omit) }}"
        size: "{{ item.size | default(omit) }}"
        type: "{{ item.type | default(omit) }}"
      with_items: "{{ ssh_keys_generate_keys }}"

    - name: Generate public ssh key
      openssl_publickey:
        path: "{{ item.path }}.pub"
        force: "{{ item.force | default(false) }}"
        format: "{{ item.format | default('OpenSSH') }}"
        # comment: "{{ item.comment | default(omit) }}"
        owner: "{{ item.owner }}"
        group: "{{ item.group | default(item.owner) }}"
        mode: "{{ item.mode | default(0600) }}"
        privatekey_passphrase: "{{ item.passphrase | default(omit) }}"
        privatekey_path: "{{ item.path }}"
      with_items: "{{ ssh_keys_generate_keys }}"
  delegate_to: localhost
